package dev.oianmol.sampleandroidapp.rules

import android.os.Build.VERSION_CODES
import android.provider.Settings.Global
import androidx.annotation.RequiresApi
import androidx.test.platform.app.InstrumentationRegistry
import androidx.test.uiautomator.UiDevice
import java.io.IOException

object InstrumentationTestingUtils {
    @RequiresApi(VERSION_CODES.N)
    fun disableAnimations() {
        executeShellCommand(
            "settings put global " + Global.TRANSITION_ANIMATION_SCALE + " 0.0"
        )
        executeShellCommand(
            "settings put global " + Global.WINDOW_ANIMATION_SCALE + " 0.0"
        )
        executeShellCommand(
            "settings put global " + Global.ANIMATOR_DURATION_SCALE + "0.0"
        )
    }

    @RequiresApi(VERSION_CODES.N)
    fun enableAnimations() {
        executeShellCommand(
            "settings put global " + Global.TRANSITION_ANIMATION_SCALE + " 1.0"
        )
        executeShellCommand(
            "settings put global " + Global.WINDOW_ANIMATION_SCALE + " 1.0"
        )
        executeShellCommand(
            "settings put global " + Global.ANIMATOR_DURATION_SCALE + " 1.0"
        )
    }

    fun executeShellCommand(command: String) {
        try {
            UiDevice.getInstance(InstrumentationRegistry.getInstrumentation())
                .executeShellCommand(command)
        } catch (ignore: IOException) {
        }
    }
}
