package dev.oianmol.dev.oianmol.opentestlab.android.adbandfriends

import com.vendsy.testlab.DeviceFarmInfo
import com.vendsy.testlab.DeviceFarmServiceGrpcKt
import com.vendsy.testlab.Empty
import kotlinx.coroutines.CoroutineDispatcher
import kotlinx.coroutines.Dispatchers

class DeviceFarmService(
    private val deviceDiscovery: DeviceDiscovery,
    dispatcher: CoroutineDispatcher = Dispatchers.IO
) : DeviceFarmServiceGrpcKt.DeviceFarmServiceCoroutineImplBase(dispatcher) {
    override suspend fun getDeviceFarm(request: Empty): DeviceFarmInfo {
        return DeviceFarmInfo.newBuilder()
            .addAllMachines( // TODO in future we need to send a list of all machine in the test lab which has devices connected to it
                listOf(
                    deviceDiscovery.hostMachine()
                )
            )
            .build()
    }
}